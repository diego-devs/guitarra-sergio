<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé∏ Guitarra & R√≠tmica ‚Äî Sergio Franco</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#1a1a2e;--bg2:#16213e;--bg3:#0f3460;--gold:#d4a574;--red:#c0392b;--text:#e8d5b7;--text2:#b8a080;--card:#1e2a4a;--card2:#243356}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding-bottom:140px}
header{background:linear-gradient(135deg,var(--bg2),var(--bg3));padding:20px;text-align:center;border-bottom:3px solid var(--gold);position:relative;overflow:hidden}
header::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4a574' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")}
header h1{font-size:1.8em;color:var(--gold);position:relative}
header p{color:var(--text2);font-size:1.1em;margin-top:4px;position:relative}
.progress-bar{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:12px;position:relative}
.progress-bar span{font-size:.85em;color:var(--text2)}
.progress-track{width:200px;height:8px;background:var(--bg);border-radius:4px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--red));border-radius:4px;transition:width .5s}
nav{display:flex;justify-content:center;gap:0;background:var(--bg2);position:sticky;top:0;z-index:50;border-bottom:2px solid var(--gold)}
nav button{flex:1;max-width:200px;padding:14px 10px;border:none;background:transparent;color:var(--text2);font-size:.95em;font-weight:600;cursor:pointer;transition:all .3s;position:relative}
nav button.active{color:var(--gold)}
nav button.active::after{content:'';position:absolute;bottom:0;left:20%;right:20%;height:3px;background:var(--gold);border-radius:3px 3px 0 0}
nav button:hover{color:var(--gold);background:rgba(212,165,116,.08)}
.tab-content{display:none;padding:16px;max-width:800px;margin:0 auto}
.tab-content.active{display:block}
.exercise-card{background:var(--card);border-radius:12px;margin-bottom:14px;overflow:hidden;border:1px solid rgba(212,165,116,.15);transition:all .3s}
.exercise-card.completed{border-color:var(--gold)}
.card-header{padding:16px;cursor:pointer;display:flex;align-items:center;gap:12px;user-select:none}
.card-header:hover{background:rgba(212,165,116,.05)}
.card-num{width:32px;height:32px;border-radius:50%;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85em;color:var(--gold);flex-shrink:0}
.exercise-card.completed .card-num{background:var(--gold);color:var(--bg)}
.card-title{flex:1;font-weight:600;font-size:1em}
.card-arrow{color:var(--text2);transition:transform .3s;font-size:1.2em}
.exercise-card.open .card-arrow{transform:rotate(180deg)}
.card-body{display:none;padding:0 16px 16px;animation:fadeIn .3s}
.exercise-card.open .card-body{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
.card-body p{line-height:1.6;color:var(--text2);margin-bottom:10px}
.tip{background:rgba(212,165,116,.1);border-left:3px solid var(--gold);padding:10px 14px;border-radius:0 8px 8px 0;margin:12px 0;font-size:.9em}
.tip strong{color:var(--gold)}
.btn{display:inline-flex;align-items:center;gap:6px;padding:10px 18px;border:none;border-radius:8px;cursor:pointer;font-size:.9em;font-weight:600;transition:all .2s}
.btn-metro{background:var(--red);color:#fff;margin-top:8px}
.btn-metro:hover{background:#e74c3c;transform:scale(1.03)}
.btn-done{background:transparent;border:2px solid var(--gold);color:var(--gold);margin-top:8px;margin-left:8px}
.btn-done:hover,.btn-done.checked{background:var(--gold);color:var(--bg)}
/* Chord Diagrams */
.chord-container{display:flex;flex-wrap:wrap;gap:20px;margin:14px 0;justify-content:center}
.chord-box{text-align:center}
.chord-name{font-weight:700;color:var(--gold);margin-bottom:6px;font-size:1.1em}
.chord-grid{display:grid;grid-template-columns:20px repeat(5,28px);grid-template-rows:repeat(6,22px);gap:0;border-collapse:collapse;position:relative;margin:0 auto}
.chord-grid::before{content:'';position:absolute;top:0;left:20px;right:0;height:4px;background:var(--text);border-radius:2px}
.chord-string-label{display:flex;align-items:center;justify-content:center;font-size:.75em;color:var(--text2);font-weight:700}
.chord-cell{border:1px solid rgba(212,165,116,.3);display:flex;align-items:center;justify-content:center;position:relative}
.chord-dot{width:20px;height:20px;border-radius:50%;background:var(--gold);color:var(--bg);font-size:.7em;font-weight:700;display:flex;align-items:center;justify-content:center}
.chord-barre{position:absolute;left:-4px;right:-4px;height:20px;background:var(--gold);border-radius:10px;opacity:.7}
.open-strings{display:flex;gap:28px;margin-left:20px;margin-bottom:2px}
.open-string{width:28px;text-align:center;font-size:.8em;font-weight:700;color:var(--text2)}
/* Tablature */
.tab-display{background:var(--bg);border-radius:8px;padding:14px;margin:12px 0;overflow-x:auto;font-family:'Courier New',monospace;font-size:.85em;line-height:1.7;color:var(--gold);white-space:pre}
/* Metronome */
.metronome-bar{position:fixed;bottom:0;left:0;right:0;background:linear-gradient(180deg,var(--bg2),#0d1526);border-top:2px solid var(--gold);padding:12px 16px;z-index:100;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:12px}
.metro-beats{display:flex;gap:8px}
.metro-beat{width:28px;height:28px;border-radius:50%;border:2px solid var(--text2);display:flex;align-items:center;justify-content:center;font-size:.8em;font-weight:700;color:var(--text2);transition:all .1s}
.metro-beat.active{border-color:var(--gold);color:var(--gold);background:rgba(212,165,116,.2);transform:scale(1.2)}
.metro-beat.accent{border-color:var(--red);color:var(--red);background:rgba(192,57,43,.2)}
.metro-controls{display:flex;align-items:center;gap:8px}
.metro-btn{width:36px;height:36px;border-radius:50%;border:2px solid var(--gold);background:transparent;color:var(--gold);font-size:1.1em;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.metro-btn:hover{background:var(--gold);color:var(--bg)}
.metro-btn.playing{background:var(--red);border-color:var(--red);color:#fff}
.bpm-display{font-size:1.4em;font-weight:700;color:var(--gold);min-width:60px;text-align:center}
.bpm-label{font-size:.7em;color:var(--text2);font-weight:400}
input[type=range]{-webkit-appearance:none;width:100px;height:6px;background:var(--bg);border-radius:3px;outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:var(--gold);border-radius:50%;cursor:pointer}
.tap-btn{padding:6px 14px;border:2px solid var(--text2);background:transparent;color:var(--text2);border-radius:6px;font-size:.8em;cursor:pointer;font-weight:600}
.tap-btn:hover{border-color:var(--gold);color:var(--gold)}
.time-sig-btn{padding:4px 10px;border:1px solid var(--text2);background:transparent;color:var(--text2);border-radius:4px;font-size:.75em;cursor:pointer}
.time-sig-btn.active{border-color:var(--gold);color:var(--gold);background:rgba(212,165,116,.15)}
.section-title{color:var(--gold);font-size:1.1em;margin:16px 0 8px;padding-bottom:6px;border-bottom:1px solid rgba(212,165,116,.2)}
@media(max-width:600px){
  header h1{font-size:1.4em}
  .chord-grid{grid-template-columns:16px repeat(5,24px);grid-template-rows:repeat(6,20px)}
  .chord-dot{width:17px;height:17px;font-size:.65em}
  .open-strings{gap:24px;margin-left:16px}
  .metronome-bar{padding:8px 10px;gap:8px}
  .bpm-display{font-size:1.1em}
  input[type=range]{width:70px}
}
</style>
</head>
<body>

<header>
  <h1>üé∏ Guitarra & R√≠tmica</h1>
  <p>Para Sergio Franco</p>
  <div class="progress-bar">
    <span>Progreso:</span>
    <div class="progress-track"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
    <span id="progressText">0%</span>
  </div>
</header>

<nav>
  <button class="active" onclick="showTab('principiante',this)">üå± Principiante</button>
  <button onclick="showTab('intermedio',this)">üî• Intermedio</button>
  <button onclick="showTab('avanzado',this)">‚ö° Avanzado</button>
</nav>

<div class="tab-content active" id="tab-principiante"></div>
<div class="tab-content" id="tab-intermedio"></div>
<div class="tab-content" id="tab-avanzado"></div>

<div class="metronome-bar">
  <div class="metro-beats" id="metroBeats">
    <div class="metro-beat" data-beat="0">1</div>
    <div class="metro-beat" data-beat="1">2</div>
    <div class="metro-beat" data-beat="2">3</div>
    <div class="metro-beat" data-beat="3">4</div>
  </div>
  <div class="metro-controls">
    <button class="metro-btn" onclick="changeBpm(-5)">‚àí</button>
    <div class="bpm-display"><span id="bpmVal">80</span><br><span class="bpm-label">BPM</span></div>
    <button class="metro-btn" onclick="changeBpm(5)">+</button>
  </div>
  <input type="range" min="40" max="200" value="80" id="bpmSlider" oninput="setBpm(+this.value)">
  <button class="metro-btn" id="playBtn" onclick="toggleMetronome()">‚ñ∂</button>
  <button class="tap-btn" onclick="tapTempo()">TAP</button>
  <div style="display:flex;gap:4px">
    <button class="time-sig-btn active" onclick="setTimeSig(4,this)">4/4</button>
    <button class="time-sig-btn" onclick="setTimeSig(3,this)">3/4</button>
    <button class="time-sig-btn" onclick="setTimeSig(6,this)">6/8</button>
  </div>
</div>

<script>
// ========== DATA ==========
const EXERCISES = {
principiante: [
{
  title: "Postura y mano derecha ‚Äî Rasgueo b√°sico abajo",
  desc: "Aprende la posici√≥n correcta de la guitarra y el rasgueo b√°sico hacia abajo con la mano derecha.",
  tip: "Mant√©n la mu√±eca relajada. El movimiento viene del antebrazo, no de los dedos. Rasguea todas las cuerdas de arriba (6¬™) hacia abajo (1¬™).",
  bpm: 60,
  tab: `Rasgueo abajo (‚Üì) en cada tiempo:
e|--0---0---0---0--|
B|--0---0---0---0--|
G|--0---0---0---0--|
D|--0---0---0---0--|
A|--0---0---0---0--|
E|--0---0---0---0--|
     ‚Üì   ‚Üì   ‚Üì   ‚Üì`,
  chords: []
},
{
  title: "Acordes abiertos: Em, Am, Dm",
  desc: "Los tres acordes menores abiertos esenciales. Memoriza las posiciones y practica la limpieza de cada nota.",
  tip: "Toca cada cuerda por separado para verificar que todas suenan limpias. Presiona cerca del traste (no encima).",
  bpm: 60,
  chords: ["Em","Am","Dm"],
  tab: `Practica cada acorde 4 tiempos:
Em           Am           Dm
e|--0------||--0------||--1------|
B|--0------||--1------||--3------|
G|--0------||--2------||--2------|
D|--2------||--2------||--0------|
A|--2------||--0------||--x------|
E|--0------||--x------||--x------|`
},
{
  title: "Acordes abiertos: G, C, D",
  desc: "Tres acordes mayores que forman la base de miles de canciones.",
  tip: "En el acorde de G, el dedo me√±ique en la 1¬™ cuerda traste 3 da un sonido m√°s lleno. En C, la 6¬™ cuerda no suena.",
  bpm: 65,
  chords: ["G","C","D"],
  tab: `G            C            D
e|--3------||--0------||--2------|
B|--0------||--1------||--3------|
G|--0------||--0------||--2------|
D|--0------||--2------||--0------|
A|--2------||--3------||--x------|
E|--3------||--x------||--x------|`
},
{
  title: "Rasgueo abajo-arriba en negras",
  desc: "Agrega el rasgueo hacia arriba. Abajo en tiempos fuertes (1,2,3,4) y arriba en los 'y' entre tiempos.",
  tip: "El rasgueo arriba es m√°s ligero ‚Äî solo las primeras 3-4 cuerdas. Cuenta: 1 y 2 y 3 y 4 y.",
  bpm: 70,
  chords: ["Em"],
  tab: `Patr√≥n abajo-arriba con Em:
e|--0-0-0-0-0-0-0-0--|
B|--0-0-0-0-0-0-0-0--|
G|--0-0-0-0-0-0-0-0--|
D|--2-2-2-2-2-2-2-2--|
A|--2-2-2-2-2-2-2-2--|
E|--0-0-0-0-0-0-0-0--|
   ‚Üì ‚Üë ‚Üì ‚Üë ‚Üì ‚Üë ‚Üì ‚Üë
   1 y 2 y 3 y 4 y`
},
{
  title: "Cambios de acordes: Em‚ÜíAm, G‚ÜíC",
  desc: "Practica transiciones suaves entre pares de acordes. El objetivo es cambiar sin parar el ritmo.",
  tip: "Busca 'dedos ancla' ‚Äî dedos que no se mueven entre acordes. De Em a Am, el dedo 2 se queda en la 4¬™ cuerda traste 2.",
  bpm: 60,
  chords: ["Em","Am","G","C"],
  tab: `Cambio cada 4 tiempos:
|  Em  |  Em  |  Am  |  Am  |
|  ‚Üì‚Üë‚Üì‚Üë|  ‚Üì‚Üë‚Üì‚Üë|  ‚Üì‚Üë‚Üì‚Üë|  ‚Üì‚Üë‚Üì‚Üë|

|  G   |  G   |  C   |  C   |
|  ‚Üì‚Üë‚Üì‚Üë|  ‚Üì‚Üë‚Üì‚Üë|  ‚Üì‚Üë‚Üì‚Üë|  ‚Üì‚Üë‚Üì‚Üë|`
},
{
  title: "Patr√≥n r√≠tmico b√°sico 4/4",
  desc: "El patr√≥n de rasgueo m√°s usado en pop/rock: Abajo, Abajo-Arriba, Arriba-Abajo-Arriba.",
  tip: "La mano NUNCA para de moverse. En los silencios, la mano sigue el movimiento pero no toca las cuerdas.",
  bpm: 75,
  chords: ["G","C"],
  tab: `Patr√≥n:  ‚Üì   ‚Üì‚Üë  ‚Üë‚Üì‚Üë
Cuenta:  1   2 y   y 4 y

Con G y C (cambio cada comp√°s):
|: G           | C           :|
   ‚Üì   ‚Üì‚Üë  ‚Üë‚Üì‚Üë  ‚Üì   ‚Üì‚Üë  ‚Üë‚Üì‚Üë`
},
{
  title: "Primera canci√≥n simple: Em - G - D - C",
  desc: "¬°Tu primera canci√≥n! Esta progresi√≥n es la base de cientos de hits. Practica con el patr√≥n r√≠tmico aprendido.",
  tip: "No te preocupes por la velocidad. Primero limpieza, luego velocidad. Repite hasta que sea autom√°tico.",
  bpm: 80,
  chords: ["Em","G","D","C"],
  tab: `Progresi√≥n (2 compases cada acorde):
|  Em    |  Em    |  G     |  G     |
|  ‚Üì ‚Üì‚Üë‚Üë‚Üì‚Üë| ‚Üì ‚Üì‚Üë‚Üë‚Üì‚Üë| ‚Üì ‚Üì‚Üë‚Üë‚Üì‚Üë| ‚Üì ‚Üì‚Üë‚Üë‚Üì‚Üë|

|  D     |  D     |  C     |  C     |
|  ‚Üì ‚Üì‚Üë‚Üë‚Üì‚Üë| ‚Üì ‚Üì‚Üë‚Üë‚Üì‚Üë| ‚Üì ‚Üì‚Üë‚Üë‚Üì‚Üë| ‚Üì ‚Üì‚Üë‚Üë‚Üì‚Üë|`
},
{
  title: "Fingerpicking intro ‚Äî Pulgar en bajos",
  desc: "Introducci√≥n al fingerpicking: el pulgar (p) toca las cuerdas graves (4, 5, 6). √çndice (i), medio (m) y anular (a) las agudas.",
  tip: "Asigna: p=bajo del acorde, i=3¬™ cuerda, m=2¬™ cuerda, a=1¬™ cuerda. Empieza MUY lento.",
  bpm: 55,
  chords: ["Am","Em"],
  tab: `Fingerpicking b√°sico con Am:
     p  i  m  a  m  i
e|--------0-----0----|
B|------1-----1------|
G|----2-----2--------|
D|--2----------------|
A|0------------------|
E|-------------------|

Con Em:
     p  i  m  a  m  i
e|--------0-----0----|
B|------0-----0------|
G|----0-----0--------|
D|--2----------------|
A|--2----------------|
E|0------------------|`
}
],
intermedio: [
{
  title: "Acordes con cejilla: F y Bm",
  desc: "La cejilla es la barrera #1 de los guitarristas. El dedo √≠ndice act√∫a como una cejilla presionando todas las cuerdas.",
  tip: "Usa el BORDE del dedo √≠ndice (el lado que mira al pulgar), no la parte plana. El pulgar debe estar detr√°s del m√°stil, a la altura del 2¬∫ dedo.",
  bpm: 60,
  chords: ["F","Bm"],
  tab: `F (cejilla traste 1):     Bm (cejilla traste 2):
e|--1---||--2---|        e|--2---||--2---|
B|--1---||--3---|        B|--3---||--3---|
G|--2---||--2---|        G|--4---||--4---|
D|--3---||--3---|        D|--4---||--4---|
A|--3---||--x---|        A|--2---||--2---|
E|--1---||--x---|        E|--x---||--x---|

Practica: Am ‚Üí F ‚Üí C ‚Üí G (cambio cada 2 tiempos)`
},
{
  title: "Patrones de rasgueo sincopado",
  desc: "La s√≠ncopa acent√∫a los tiempos d√©biles ('y'), creando un feel m√°s groovy y moderno.",
  tip: "Silencia (mute) las cuerdas levantando ligeramente la mano izquierda en los tiempos que llevan 'x'. Esto crea el efecto percusivo.",
  bpm: 85,
  chords: ["Am","F"],
  tab: `Patr√≥n sincopado:
   1  y  2  y  3  y  4  y
   ‚Üì  ‚Üë  x  ‚Üë  ‚Üì  x  ‚Üì  ‚Üë
   >        >        >

(> = acento, x = mute/ghost strum)

Practica con Am y F alternando cada comp√°s.`
},
{
  title: "Fingerpicking: Travis Picking",
  desc: "Patr√≥n de fingerpicking donde el pulgar alterna entre dos cuerdas graves mientras los dedos tocan una melod√≠a en las agudas.",
  tip: "El pulgar lleva el RITMO ‚Äî debe ser constante como un reloj. Los dedos a√±aden notas entre los pulsos del pulgar.",
  bpm: 65,
  chords: ["C","G"],
  tab: `Travis picking en C:
   p     i  p  m     p  i  p
e|----------0--------0------|
B|-------1--------1---------|
G|----0--------0------------|
D|--2--------2--------2-----|
A|3--------3--------3-------|
E|--------------------------|

Travis picking en G:
   p     i  p  m     p  i  p
e|----------0--------0------|
B|-------0--------0---------|
G|----0--------0------------|
D|--0--------0--------0-----|
A|--------------------------|
E|3--------3--------3-------|`
},
{
  title: "Escalas pentat√≥nicas: Am y Em",
  desc: "La escala pentat√≥nica menor es LA escala para improvisar en rock, blues y pop. 5 notas, infinitas posibilidades.",
  tip: "Aprende la Posici√≥n 1 (caja) primero. Usa alternate picking (‚Üì‚Üë) siempre. Practica con metr√≥nomo subiendo de 5 en 5 BPM.",
  bpm: 70,
  chords: [],
  tab: `Am Pentat√≥nica ‚Äî Posici√≥n 1 (traste 5):
e|--5---8------------|
B|--5---8------------|
G|--5---7------------|
D|--5---7------------|
A|--5---7------------|
E|--5---8------------|

Ejercicio: subir y bajar
e|------------------5-8--|
B|--------------5-8------|
G|----------5-7----------|
D|------5-7--------------|
A|--5-7------------------|
E|5-8--------------------|

Em Pentat√≥nica ‚Äî Posici√≥n abierta:
e|--0---3------------|
B|--0---3------------|
G|--0---2------------|
D|--0---2------------|
A|--0---2------------|
E|--0---3------------|`
},
{
  title: "Hammer-on y Pull-off",
  desc: "Ligados ascendentes (hammer-on) y descendentes (pull-off). Solo tocas una vez con la p√∫a y los dedos hacen el resto.",
  tip: "Hammer-on: golpea el traste con fuerza. Pull-off: 'tira' la cuerda ligeramente hacia abajo al soltar, no solo levantes el dedo.",
  bpm: 70,
  chords: [],
  tab: `Hammer-on (h) y Pull-off (p):
e|--0h3--3p0--0h3--3p0--|
B|--0h1--1p0--0h1--1p0--|
G|--0h2--2p0--0h2--2p0--|
D|--0h2--2p0--0h2--2p0--|
A|--0h2--2p0--0h2--2p0--|
E|--0h3--3p0--0h3--3p0--|

Combinaci√≥n en pentat√≥nica Am:
e|--5h8--8p5------------|
B|--5h8--8p5------------|
G|--5h7--7p5------------|
D|--5h7--7p5------------|
A|--5h7--7p5------------|
E|--5h8--8p5------------|`
},
{
  title: "Ritmos de Bossa Nova",
  desc: "El ritmo de bossa nova combina bajo con pulgar y acordes con dedos en un patr√≥n sincopado brasile√±o.",
  tip: "El pulgar toca en los tiempos 1 y 3 (o 'y' del 2). Los dedos hacen el patr√≥n sincopado. Escucha a Jo√£o Gilberto como referencia.",
  bpm: 72,
  chords: ["Am","Dm"],
  tab: `Patr√≥n bossa nova b√°sico:
Tiempo: 1  y  2  y  3  y  4  y
Pulgar: x        x     x
Dedos:     x  x     x     x  x

Con Am7:
e|-----0--0-----0--0--0--|
B|-----1--1-----1--1--1--|
G|-----0--0-----0--0--0--|
D|--2--------2-----------|
A|0-----------0----------|
E|-----------------------|

Con Dm7:
e|-----1--1-----1--1--1--|
B|-----1--1-----1--1--1--|
G|-----2--2-----2--2--2--|
D|--0--------0-----------|
A|-----------0-----------|
E|-----------------------|`
},
{
  title: "Arpegios con mano derecha",
  desc: "Patrones de arpegio usando p-i-m-a en distintas combinaciones para acompa√±ar baladas y piezas cl√°sicas.",
  tip: "Mant√©n la mano derecha flotando sobre las cuerdas sin apoyarse. Los dedos se mueven desde los nudillos, no desde las puntas.",
  bpm: 65,
  chords: ["Am","C","G","Em"],
  tab: `Patr√≥n 1 (p-i-m-a-m-i):
Am:                    C:
e|--------0-----0--|  e|--------0-----0--|
B|------1-----1----|  B|------1-----1----|
G|----2-----2------|  G|----0-----0------|
D|--2--------------|  D|--2--------------|
A|0----------------|  A|3----------------|
E|-----------------|  E|-----------------|

Patr√≥n 2 (p-i-m-a simult√°neo):
Am:                    Em:
e|----0---0---0----|  e|----0---0---0----|
B|----1---1---1----|  B|----0---0---0----|
G|----2---2---2----|  G|----0---0---0----|
A|--0---0---0------|  E|--0---0---0------|`
},
{
  title: "Palm muting y acentos r√≠tmicos",
  desc: "El palm mute (P.M.) se logra apoyando el canto de la mano derecha sobre las cuerdas cerca del puente. Los acentos (>) dan din√°mica.",
  tip: "Para P.M.: apoya SUAVEMENTE. Demasiada presi√≥n mata el sonido. Muy poca y no se nota el efecto. Busca el punto dulce.",
  bpm: 90,
  chords: ["E5","A5"],
  tab: `Palm mute con power chords:
E5:
e|------------------------|
B|------------------------|
G|------------------------|
D|--2-2-2-2--2-2-2-2-----|
A|--2-2-2-2--2-2-2-2-----|
E|--0-0-0-0--0-0-0-0-----|
   P.M.~~~~  P.M.~~ >

Patr√≥n acentuado:
e|----------------------------|
B|----------------------------|
G|----------------------------|
D|--2-2-2-2--2-2-2-2--2-2----|
A|--2-2-2-2--2-2-2-2--2-2----|
E|--0-0-0-0--0-0-0-0--0-0----|
   P.M.      >  P.M.  > >`
}
],
avanzado: [
{
  title: "Escalas modales: D√≥rica y Mixolidia",
  desc: "La escala D√≥rica (menor con 6¬™ mayor) es perfecta para jazz/funk. La Mixolidia (mayor con 7¬™ menor) para blues/rock.",
  tip: "D√≥rica = menor natural con el 6¬∫ grado subido medio tono. Mixolidia = escala mayor con el 7¬∫ grado bajado. Practica sobre un drone o backing track.",
  bpm: 80,
  chords: [],
  tab: `D D√≥rica (sobre Dm7):
e|------------------5-7-8--|
B|--------------5-6--------|
G|----------5-7------------|
D|------5-7----------------|
A|--5-7--------------------|
E|5-7-8--------------------|
  D E F G A B C D

G Mixolidia (sobre G7):
e|------------------5-7-8--|
B|--------------5-6--------|
G|----------4-5------------|
D|------3-5----------------|
A|--3-5--------------------|
E|3-5-6--------------------|
  G A B C D E F G`
},
{
  title: "Fingerstyle: melod√≠a + bajo simult√°neo",
  desc: "La t√©cnica de fingerstyle independiza pulgar (bajo) y dedos (melod√≠a), creando un efecto de dos guitarras.",
  tip: "Practica cada voz por separado primero. Luego comb√≠nalas MUY lento. El bajo debe sonar parejo y constante.",
  bpm: 60,
  chords: [],
  tab: `"Estudio en Am" ‚Äî melod√≠a + bajo:
    Bajo:          Melod√≠a:
e|--------0---1---0-----------|
B|------1---1---1---1---------|
G|----2---2---2---2---2-------|
D|--2-----------2-------------|
A|0-----------0---------------|
E|----------------------------|

Ejercicio de independencia:
e|--0-----0-----1-----0------|
B|----1-----1-----1-----1----|
G|------2-----2-----2-----2--|
D|0-------0-------0-------0--|
A|----------------------------|
E|----------------------------|`
},
{
  title: "Ritmos compuestos: 6/8 y 3/4",
  desc: "El 6/8 tiene 2 grupos de 3 (1-2-3, 4-5-6). El 3/4 tiene 3 tiempos iguales. Cambian completamente el feel.",
  tip: "En 6/8, acent√∫a los tiempos 1 y 4. Usa el metr√≥nomo en 6/8 para sentir la subdivisi√≥n ternaria.",
  bpm: 75,
  chords: ["Am","Em","G"],
  tab: `6/8 ‚Äî Arpegio (tipo 'Nothing Else Matters'):
Am:
e|------0---------0------|
B|----0---0-----0---0----|
G|--2-------2-2-------2--|
D|0-----------0----------|
A|-----------------------|
E|-----------------------|
  1 2 3 4 5 6

3/4 ‚Äî Vals:
Am        Em        G
‚Üì  ‚Üë‚Üì  ‚Üë‚Üì  ‚Üë‚Üì  ‚Üë‚Üì  ‚Üë‚Üì
1  2 3  1  2 3  1  2 3`
},
{
  title: "Acordes extendidos: 7ma y 9na",
  desc: "Los acordes de 7¬™ y 9¬™ a√±aden color arm√≥nico. Esenciales para jazz, soul, neo-soul y R&B.",
  tip: "No intentes tocar las 6 cuerdas siempre. Muchos voicings de jazz usan solo 4 cuerdas. Menos es m√°s.",
  bpm: 65,
  chords: ["Cmaj7","Am7","Dm9","G7"],
  tab: `Progresi√≥n jazzy (ii-V-I en C):
Dm9         G7          Cmaj7
e|--1---||--1---||--0---|
B|--1---||--0---||--0---|
G|--2---||--0---||--0---|
D|--0---||--0---||--2---|
A|--x---||--2---||--3---|
E|--x---||--3---||--x---|

Progresi√≥n neo-soul:
| Cmaj7 | Am7 | Dm9 | G7 |
  Rasgueo suave con ghost notes`
},
{
  title: "T√©cnica de percusi√≥n en guitarra",
  desc: "Golpes percusivos en la caja (tapa) de la guitarra mientras tocas, al estilo de artistas como Andy McKee.",
  tip: "Golpe en la tapa (T) con los dedos, slap en cuerdas (S) con el pulgar, y golpe lateral (L) con la palma. Mant√©n el ritmo constante.",
  bpm: 85,
  chords: [],
  tab: `Patr√≥n percusivo b√°sico:
Tiempo: 1   y   2   y   3   y   4   y
Acci√≥n: T   G   S   G   T   G   S   G

T = Golpe en tapa (kick)
S = Slap en cuerdas (snare)
G = Nota de guitarra

Combinado con acordes:
e|--x---0---x---0---x---0---x---0--|
B|--x---1---x---1---x---1---x---1--|
G|--x---2---x---2---x---2---x---2--|
D|--T---2---S---2---T---2---S---2--|
A|--x---0---x---0---x---0---x---0--|
E|--x---x---x---x---x---x---x---x--|`
},
{
  title: "Improvisaci√≥n sobre progresiones",
  desc: "Combina escalas pentat√≥nicas y modales sobre progresiones comunes. La clave: escuchar antes de tocar.",
  tip: "Regla de oro: toca MENOS notas pero con m√°s intenci√≥n. Usa silencios. Apunta a las notas del acorde en tiempos fuertes.",
  bpm: 80,
  chords: ["Am","F","C","G"],
  tab: `Progresi√≥n: Am - F - C - G
Escala: Am pentat√≥nica + notas de color

Lick 1 (sobre Am):
e|--8b10--8--5---------|
B|-------------8p5-----|
G|------------------7--|

Lick 2 (sobre F-C):
e|--5--8--5------------|
B|-----------6--5------|
G|----------------7-5--|

Lick 3 (sobre G):
e|--8--10--8--5--------|
B|--------------8--5---|
G|-------------------7-|

b=bend, p=pull-off`
},
{
  title: "Poliritmias con mano derecha",
  desc: "El pulgar toca en un patr√≥n (ej: negras) mientras los dedos tocan en otro (ej: tresillos), creando poliritmia 3:2 o 4:3.",
  tip: "Empieza con 2 contra 3: pulgar en negras (1-2) y dedos en tresillos (1-2-3) dentro del mismo comp√°s. Cuenta 'TO-MA-TE' para el tresillo.",
  bpm: 60,
  chords: [],
  tab: `Poliritmia 3 contra 2:
Pulgar (2):  x           x
Dedos (3):   x       x       x
Cuenta:      1   &   2   &   3   &

Ejercicio pr√°ctico en Am:
Pulgar:      A-------A-------
Dedos:       e-e-e---e-e-e---
Combinado:
e|--0---0---0---0---0---0--|
B|--1---1---1---1---1---1--|
G|--2---2---2---2---2---2--|
A|0-----------0------------|

Poliritmia 4 contra 3:
Pulgar (3):  x       x       x
Dedos (4):   x     x     x     x`
}
]
};

// ========== CHORD DIAGRAMS DATA ==========
const CHORD_DATA = {
  "Em":  {open:["O","O","O","O","O","O"], frets:[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,2,1,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,2,1,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "Am":  {open:["X","O","O","O","O","O"], frets:[[0,0,0,0,1,0],[0,0,2,2,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,1,0],[0,0,3,2,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "Dm":  {open:["X","X","O","O","O","O"], frets:[[0,0,0,0,1,0],[0,0,0,0,0,0],[0,0,0,2,0,3]], fingers:[[0,0,0,0,1,0],[0,0,0,0,0,0],[0,0,0,2,0,3]], startFret:0},
  "G":   {open:["O","O","O","O","O","O"], frets:[[0,0,0,0,0,0],[0,1,0,0,0,0],[0,0,0,0,0,3],[3,0,0,0,2,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,0,0],[0,1,0,0,0,0],[0,0,0,0,0,4],[2,0,0,0,3,0],[0,0,0,0,0,0]], startFret:0},
  "C":   {open:["X","O","O","O","O","O"], frets:[[0,0,0,0,1,0],[0,0,0,2,0,0],[0,3,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,1,0],[0,0,0,2,0,0],[0,3,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "D":   {open:["X","X","O","O","O","O"], frets:[[0,0,0,0,0,0],[0,0,0,2,0,3],[0,0,0,0,1,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,0,0],[0,0,0,1,0,3],[0,0,0,0,2,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "F":   {open:["O","O","O","O","O","O"], frets:[[1,1,0,0,1,1],[0,0,0,0,0,0],[0,0,2,0,0,0],[0,0,0,3,0,0],[0,0,0,0,0,0]], fingers:[[1,1,0,0,1,1],[0,0,0,0,0,0],[0,0,2,0,0,0],[0,0,0,3,0,0],[0,0,0,0,0,0]], startFret:0, barre:1},
  "Bm":  {open:["X","O","O","O","O","O"], frets:[[0,1,0,0,1,1],[0,0,0,0,0,0],[0,0,2,0,0,0],[0,0,0,3,3,0],[0,0,0,0,0,0]], fingers:[[0,1,0,0,1,1],[0,0,0,0,0,0],[0,0,2,0,0,0],[0,0,0,3,4,0],[0,0,0,0,0,0]], startFret:1},
  "E5":  {open:["O","O","X","X","X","X"], frets:[[0,0,0,0,0,0],[0,0,0,2,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,0,0],[0,0,0,1,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "A5":  {open:["X","O","O","X","X","X"], frets:[[0,0,0,0,0,0],[0,0,0,2,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,0,0],[0,0,0,1,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "Cmaj7":{open:["X","O","O","O","O","O"], frets:[[0,0,0,0,0,0],[0,0,0,2,0,0],[0,3,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,0,0],[0,0,0,2,0,0],[0,3,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "Am7": {open:["X","O","O","O","O","O"], frets:[[0,0,0,0,0,0],[0,0,0,2,1,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,0,0],[0,0,0,2,1,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "Dm9": {open:["X","X","O","O","O","O"], frets:[[0,0,0,0,1,1],[0,0,0,0,0,0],[0,0,0,2,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[0,0,0,0,1,1],[0,0,0,0,0,0],[0,0,0,2,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0},
  "G7":  {open:["O","O","O","O","O","O"], frets:[[1,0,0,0,0,0],[0,0,0,0,0,0],[3,0,0,0,2,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], fingers:[[1,0,0,0,0,0],[0,0,0,0,0,0],[3,0,0,0,2,0],[0,0,0,0,0,0],[0,0,0,0,0,0]], startFret:0}
};

function createChordDiagram(chordName) {
  const data = CHORD_DATA[chordName];
  if (!data) return `<div class="chord-box"><div class="chord-name">${chordName}</div><p style="color:var(--text2);font-size:.85em">(diagrama no disponible)</p></div>`;
  
  // Simple visual representation
  const strings = ['E','A','D','G','B','e'];
  let positions = [];
  for (let s = 0; s < 6; s++) {
    let fretPos = 0, finger = 0;
    for (let f = 0; f < 5; f++) {
      if (data.frets[f] && data.frets[f][s]) {
        fretPos = f + 1;
        finger = data.fingers[f] ? data.fingers[f][s] : 0;
        break;
      }
    }
    positions.push({fret: fretPos, finger});
  }

  let html = `<div class="chord-box"><div class="chord-name">${chordName}</div>`;
  html += `<div class="open-strings">`;
  const openArr = data.open || ["O","O","O","O","O","O"];
  for (let s = 0; s < 6; s++) {
    if (positions[s].fret === 0) {
      html += `<div class="open-string">${openArr[s]}</div>`;
    } else {
      html += `<div class="open-string">&nbsp;</div>`;
    }
  }
  html += `</div>`;
  html += `<div class="chord-grid">`;
  for (let s = 0; s < 6; s++) {
    html += `<div class="chord-string-label">${strings[5-s]}</div>`;
    for (let f = 1; f <= 5; f++) {
      let dot = '';
      if (positions[5-s].fret === f && positions[5-s].finger > 0) {
        dot = `<div class="chord-dot">${positions[5-s].finger}</div>`;
      } else if (data.barre && f === 1) {
        // Check barre
        let isBarre = false;
        for (let bs = 0; bs < 6; bs++) {
          if (data.frets[0] && data.frets[0][bs] === 1 && data.fingers[0] && data.fingers[0][bs] === 1 && (5-s) === bs && positions[5-s].fret === 1) {
            dot = `<div class="chord-dot">1</div>`;
          }
        }
      }
      html += `<div class="chord-cell">${dot}</div>`;
    }
  }
  html += `</div></div>`;
  return html;
}

// ========== RENDER ==========
function renderExercises() {
  const progress = JSON.parse(localStorage.getItem('sg-progress') || '{}');
  
  Object.keys(EXERCISES).forEach(level => {
    const container = document.getElementById(`tab-${level}`);
    container.innerHTML = '';
    EXERCISES[level].forEach((ex, i) => {
      const key = `${level}-${i}`;
      const done = progress[key];
      const card = document.createElement('div');
      card.className = `exercise-card${done ? ' completed' : ''}`;
      card.id = `card-${key}`;
      
      let chordsHtml = '';
      if (ex.chords && ex.chords.length) {
        chordsHtml = `<h4 class="section-title">Diagramas de Acordes</h4><div class="chord-container">${ex.chords.map(c => createChordDiagram(c)).join('')}</div>`;
      }
      
      card.innerHTML = `
        <div class="card-header" onclick="toggleCard('${key}')">
          <div class="card-num">${done ? '‚úì' : (i+1)}</div>
          <div class="card-title">${ex.title}</div>
          <div class="card-arrow">‚ñº</div>
        </div>
        <div class="card-body">
          <p>${ex.desc}</p>
          <div class="tip"><strong>üí° Tip:</strong> ${ex.tip}</div>
          ${chordsHtml}
          ${ex.tab ? `<h4 class="section-title">Tablatura / Ejercicio</h4><div class="tab-display">${ex.tab}</div>` : ''}
          <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:12px">
            <button class="btn btn-metro" onclick="startMetroAt(${ex.bpm})">üéµ Practicar a ${ex.bpm} BPM</button>
            <button class="btn btn-done ${done?'checked':''}" onclick="toggleDone('${key}',this)">${done ? '‚úÖ Completado' : '‚òê Marcar completado'}</button>
          </div>
        </div>`;
      container.appendChild(card);
    });
  });
  updateProgress();
}

function toggleCard(key) {
  const card = document.getElementById(`card-${key}`);
  card.classList.toggle('open');
}

function toggleDone(key, btn) {
  const progress = JSON.parse(localStorage.getItem('sg-progress') || '{}');
  progress[key] = !progress[key];
  localStorage.setItem('sg-progress', JSON.stringify(progress));
  renderExercises();
}

function updateProgress() {
  const progress = JSON.parse(localStorage.getItem('sg-progress') || '{}');
  let total = 0, done = 0;
  Object.keys(EXERCISES).forEach(l => { total += EXERCISES[l].length; EXERCISES[l].forEach((_, i) => { if (progress[`${l}-${i}`]) done++; }); });
  const pct = total ? Math.round(done/total*100) : 0;
  document.getElementById('progressFill').style.width = pct+'%';
  document.getElementById('progressText').textContent = `${done}/${total} (${pct}%)`;
}

function showTab(level, btn) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(`tab-${level}`).classList.add('active');
  btn.classList.add('active');
}

function startMetroAt(newBpm) {
  if (metroPlaying) toggleMetronome(); // stop first
  setBpm(newBpm);
  toggleMetronome(); // start fresh
}

// ========== METRONOME ==========
let audioCtx = null;
let metroPlaying = false;
let currentBeat = 0;
let metroInterval = null;
let bpm = 80;
let beatsPerMeasure = 4;
let tapTimes = [];

function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

function playClick(accent) {
  const ctx = getAudioCtx();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.frequency.value = accent ? 1000 : 700;
  osc.type = 'sine';
  gain.gain.setValueAtTime(accent ? 0.6 : 0.3, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.08);
  osc.start(ctx.currentTime);
  osc.stop(ctx.currentTime + 0.08);
}

function tick() {
  const accent = currentBeat === 0;
  playClick(accent);
  
  document.querySelectorAll('.metro-beat').forEach((el, i) => {
    el.classList.remove('active', 'accent');
    if (i === currentBeat) {
      el.classList.add('active');
      if (accent) el.classList.add('accent');
    }
  });
  
  currentBeat = (currentBeat + 1) % beatsPerMeasure;
}

function toggleMetronome() {
  // Always clear any existing interval first
  if (metroInterval) { clearInterval(metroInterval); metroInterval = null; }
  metroPlaying = !metroPlaying;
  const btn = document.getElementById('playBtn');
  if (metroPlaying) {
    getAudioCtx().resume();
    currentBeat = 0;
    tick();
    metroInterval = setInterval(tick, 60000 / bpm);
    btn.textContent = '‚è∏';
    btn.classList.add('playing');
  } else {
    clearInterval(metroInterval);
    btn.textContent = '‚ñ∂';
    btn.classList.remove('playing');
    document.querySelectorAll('.metro-beat').forEach(el => el.classList.remove('active', 'accent'));
  }
}

function setBpm(val) {
  bpm = Math.max(40, Math.min(200, val));
  document.getElementById('bpmVal').textContent = bpm;
  document.getElementById('bpmSlider').value = bpm;
  if (metroPlaying) {
    clearInterval(metroInterval);
    metroInterval = setInterval(tick, 60000 / bpm);
  }
}

function changeBpm(delta) { setBpm(bpm + delta); }

function setTimeSig(beats, btn) {
  beatsPerMeasure = beats;
  document.querySelectorAll('.time-sig-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const container = document.getElementById('metroBeats');
  container.innerHTML = '';
  for (let i = 0; i < beats; i++) {
    container.innerHTML += `<div class="metro-beat" data-beat="${i}">${i+1}</div>`;
  }
  currentBeat = 0;
}

function tapTempo() {
  const now = Date.now();
  tapTimes.push(now);
  if (tapTimes.length > 5) tapTimes.shift();
  if (tapTimes.length >= 2) {
    let sum = 0;
    for (let i = 1; i < tapTimes.length; i++) sum += tapTimes[i] - tapTimes[i-1];
    const avg = sum / (tapTimes.length - 1);
    setBpm(Math.round(60000 / avg));
  }
  // Reset if gap > 2s
  setTimeout(() => { if (Date.now() - tapTimes[tapTimes.length-1] > 2000) tapTimes = []; }, 2100);
}

// Init
renderExercises();
</script>
</body>
</html>
